<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Email_on_Approved</name>
        <label>Send Email on Approved</label>
        <locationX>182</locationX>
        <locationY>1655</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <connector>
            <targetReference>Decision_6</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddressesArray</name>
            <value>
                <elementReference>userEmail</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>SubjectForApproved</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>Approved_Template</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Email_on_Approved_to_Customer</name>
        <label>Send Email on Approved to Customer</label>
        <locationX>50</locationX>
        <locationY>1871</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <connector>
            <targetReference>Email_Message</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddressesArray</name>
            <value>
                <elementReference>CustomerEmail</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <elementReference>get_Organization_Wide_Address.Address</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>customerApprovedTemplateSubject</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>customerEmailTemplate</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Email_on_Rejected</name>
        <label>Send Email on Rejected</label>
        <locationX>578</locationX>
        <locationY>1439</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <connector>
            <targetReference>Send_Notification_on_Rejection</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddressesArray</name>
            <value>
                <elementReference>userEmail</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>SubjectForRejected</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>RejectedEmail</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Notification_on_Approved</name>
        <label>Send Notification on Approved</label>
        <locationX>182</locationX>
        <locationY>2171</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>get_Suggested_Property</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>get_Custom_Notification.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>userId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <elementReference>SubjectForApproved</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>Approved_Template</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>customNotificationAction</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Notification_on_Rejection</name>
        <label>Send Notification on Rejection</label>
        <locationX>578</locationX>
        <locationY>1547</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>get_Custom_Notification.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>userId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <elementReference>SubjectForRejected</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>RejectedEmail</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>customNotificationAction</nameSegment>
    </actionCalls>
    <apiVersion>60.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Assign_Customer_Email</name>
        <label>Assign Customer Email</label>
        <locationX>380</locationX>
        <locationY>1031</locationY>
        <assignmentItems>
            <assignToReference>CustomerEmail</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>$Record.Account.PersonEmail</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>get_Custom_Notification</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assignment_of_Sales_Manager</name>
        <label>Assignment of Sales Manager</label>
        <locationX>380</locationX>
        <locationY>731</locationY>
        <assignmentItems>
            <assignToReference>userEmail</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>$Record.Sales_Manager__r.Email</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>userId</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>$Record.Sales_Manager__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Customer_Email_Exist</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assignment_of_Site_Head</name>
        <label>Assignment of Site Head</label>
        <locationX>380</locationX>
        <locationY>431</locationY>
        <assignmentItems>
            <assignToReference>userEmail</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>$Record.Project__r.Site_Head__r.Email</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>userId</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>$Record.Project__r.Site_Head__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Check_Sales_Manager_Exist</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_Sales_Manager_Exist</name>
        <label>Check Sales_Manager Exist</label>
        <locationX>512</locationX>
        <locationY>623</locationY>
        <defaultConnector>
            <targetReference>Customer_Email_Exist</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>SalesManager</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Sales_Manager__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assignment_of_Sales_Manager</targetReference>
            </connector>
            <label>Sales Manager</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Site_Head_Exist</name>
        <label>Check Site Head Exist</label>
        <locationX>512</locationX>
        <locationY>323</locationY>
        <defaultConnector>
            <targetReference>Check_Sales_Manager_Exist</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Site_Head</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Project__r.Site_Head__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assignment_of_Site_Head</targetReference>
            </connector>
            <label>Site Head</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Suggested_property</name>
        <label>Check Suggested property</label>
        <locationX>182</locationX>
        <locationY>2387</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>If_Property_Exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>get_Suggested_Property</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>update_Property</targetReference>
            </connector>
            <label>If Property Exist</label>
        </rules>
    </decisions>
    <decisions>
        <name>Customer_Email_Exist</name>
        <label>Customer Email Exist</label>
        <locationX>512</locationX>
        <locationY>923</locationY>
        <defaultConnector>
            <targetReference>get_Custom_Notification</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>If_Email_Exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Account.PersonEmail</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Customer_Email</targetReference>
            </connector>
            <label>If Email Exist</label>
        </rules>
    </decisions>
    <decisions>
        <name>Decision_6</name>
        <label>Decision 6</label>
        <locationX>182</locationX>
        <locationY>1763</locationY>
        <defaultConnector>
            <targetReference>Send_Notification_on_Approved</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Customer_Mail_Exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CustomerEmail</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Email_on_Approved_to_Customer</targetReference>
            </connector>
            <label>Customer Mail Exist</label>
        </rules>
    </decisions>
    <decisions>
        <name>EOI_Approval_Stages</name>
        <label>EOI Approval Stages</label>
        <locationX>512</locationX>
        <locationY>1331</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>EOI_CA_Stage_Approved</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.EOI_CA_Approval_Stages__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Approved</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>get_Organization_Wide_Address</targetReference>
            </connector>
            <label>EOI/CA Stage Approved</label>
        </rules>
        <rules>
            <name>EOI_CA_Stage_Rejected</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.EOI_CA_Approval_Stages__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Rejected</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Email_on_Rejected</targetReference>
            </connector>
            <label>EOI/CA Stage Rejected</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>SalesManagerNumber</name>
        <dataType>String</dataType>
        <expression>IF({!$Record.Sales_Manager__c} !=null ,if( {!$Record.Sales_Manager__r.MobilePhone} != null &amp;&amp; {!$Record.Sales_Manager__r.MobilePhone}  != &apos;&apos; ,{!$Record.Sales_Manager__r.MobilePhone},{!$Record.Sales_Manager__r.Phone}), {!$Record.owner.MobilePhone} )</expression>
    </formulas>
    <interviewLabel>Send EOI/CA Cancellation Notification {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Send EOI/CA Cancellation Notification</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Email_Message</name>
        <label>Email Message</label>
        <locationX>50</locationX>
        <locationY>1979</locationY>
        <connector>
            <targetReference>Send_Notification_on_Approved</targetReference>
        </connector>
        <inputAssignments>
            <field>CcAddress</field>
            <value>
                <elementReference>$Record.Account.PersonEmail</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>FromAddress</field>
            <value>
                <elementReference>$Record.Project__r.Project_Email__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>FromName</field>
            <value>
                <stringValue>Dynamix</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>HtmlBody</field>
            <value>
                <elementReference>customerEmailTemplate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>MessageDate</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RelatedToId</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <stringValue>Cancellation Email Send to Customer</stringValue>
            </value>
        </inputAssignments>
        <object>EmailMessage</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <name>get_Custom_Notification</name>
        <label>get Custom Notification</label>
        <locationX>512</locationX>
        <locationY>1223</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>EOI_Approval_Stages</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Source_Change_Approved</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>CustomNotificationType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>get_Organization_Wide_Address</name>
        <label>get Organization Wide Address</label>
        <locationX>182</locationX>
        <locationY>1439</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_Records_2</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Address</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Project__r.Project_Email__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>OrgWideEmailAddress</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>get_Suggested_Property</name>
        <label>get Suggested Property</label>
        <locationX>182</locationX>
        <locationY>2279</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_Suggested_property</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Confirmed Allocation</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Suggested_Property__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>update_Property</name>
        <label>update Property</label>
        <locationX>50</locationX>
        <locationY>2495</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>get_Suggested_Property.Unit__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Property_Status__c</field>
            <value>
                <stringValue>Available</stringValue>
            </value>
        </inputAssignments>
        <object>Property__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Records_2</name>
        <label>Update Records 2</label>
        <locationX>182</locationX>
        <locationY>1547</locationY>
        <connector>
            <targetReference>Send_Email_on_Approved</targetReference>
        </connector>
        <inputAssignments>
            <field>Reason_for_lost__c</field>
            <value>
                <elementReference>$Record.Loss_Reason__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>StageName</field>
            <value>
                <stringValue>Closed Lost</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>386</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Check_Site_Head_Exist</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>EOI_CA_Approval_Stages__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>Opportunity</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>Approved_Template</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hi,
{!$Record.EOI_CA_Number__c} cancellation request for {!$Record.Account.FirstName} {!$Record.Account.LastName} for {!$Record.Project__r.Name} has been approved and stage of respective opportunity has been updated.</text>
    </textTemplates>
    <textTemplates>
        <name>customerApprovedTemplateSubject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>!$Record.EOI_CA_Number__c} is cancelled for {!$Record.Project__r.Name}</text>
    </textTemplates>
    <textTemplates>
        <name>customerEmailTemplate</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Dear  {!$Record.Account.FirstName} {!$Record.Account.LastName} ,

This is to inform you that your {!$Record.EOI_CA_Number__c} for {!$Record.Project__r.Name} has been  cancelled. In case of any queries or assistance required, please contact us on {!SalesManagerNumber}.

Regards,
Dynamix Group</text>
    </textTemplates>
    <textTemplates>
        <name>RejectedEmail</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hi,
{!$Record.EOI_CA_Number__c} cancellation request for {!$Record.Account.FirstName} {!$Record.Account.LastName} for {!$Record.Project__r.Name} has been rejected and stage of respective opportunity has been updated.</text>
    </textTemplates>
    <textTemplates>
        <name>SubjectForApproved</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$Record.EOI_CA_Number__c} is cancelled for {!$Record.Account.FirstName} {!$Record.Account.LastName}</text>
    </textTemplates>
    <textTemplates>
        <name>SubjectForRejected</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$Record.EOI_CA_Number__c} cancellation request rejected for {!$Record.Account.FirstName} {!$Record.Account.LastName}</text>
    </textTemplates>
    <variables>
        <name>CustomerEmail</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>userEmail</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>userId</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
